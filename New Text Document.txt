
// Obtém o corpo da resposta
def responseBody = prev.getResponseDataAsString()

// Define uma regex para capturar o valor
// Ajuste a regex conforme necessário
def matcher = (responseBody =~ /http_request_duration_seconds.* (\d+\.\d+)/)

// Se encontrar um valor, armazena na variável JMeter
if (matcher.find()) {
    def responseTime = matcher.group(1).toDouble() * 1000 // Converte para ms
    vars.put("responseTime", responseTime.toString())
} else {
    log.error("Não foi possível extrair o tempo de resposta do Prometheus.")
}


// Obtém o valor extraído
def avgResponseTime = vars.get("responseTime") as Double

// Verifica se o valor está disponível
if (avgResponseTime == null) {
    AssertionResult.setFailure(true)
    AssertionResult.setFailureMessage("Não foi possível extrair o tempo médio de resposta.")
} else if (avgResponseTime > 50) {
    AssertionResult.setFailure(true)
    AssertionResult.setFailureMessage("Tempo médio acima do limite: ${avgResponseTime}ms")
} else {
    AssertionResult.setFailure(false)
}
