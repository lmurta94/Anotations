import software.amazon.awssdk.auth.credentials.ProfileCredentialsProvider;
import software.amazon.awssdk.regions.Region;
import software.amazon.awssdk.services.cognitoidentityprovider.CognitoIdentityProviderClient;
import software.amazon.awssdk.services.cognitoidentityprovider.model.AuthFlowType;
import software.amazon.awssdk.services.cognitoidentityprovider.model.InitiateAuthRequest;
import software.amazon.awssdk.services.cognitoidentityprovider.model.InitiateAuthResponse;
import software.amazon.awssdk.services.cognitoidentityprovider.model.CognitoIdentityProviderException;

public class CognitoAuthExample {

    public static void main(String[] args) {
        String userPoolId = "your-user-pool-id"; // Substitua pelo ID do User Pool
        String clientId = "your-client-id"; // Substitua pelo ID do App Client
        String username = "your-username"; // Substitua pelo nome de usuário
        String password = "your-password"; // Substitua pela senha

        CognitoIdentityProviderClient cognitoClient = CognitoIdentityProviderClient.builder()
                .region(Region.US_EAST_1) // Substitua pela sua região
                .credentialsProvider(ProfileCredentialsProvider.create())
                .build();

        authenticateUser(cognitoClient, clientId, username, password);

        cognitoClient.close();
    }

    public static void authenticateUser(CognitoIdentityProviderClient cognitoClient, String clientId, String username, String password) {
        try {
            // Cria a solicitação de autenticação
            InitiateAuthRequest authRequest = InitiateAuthRequest.builder()
                    .authFlow(AuthFlowType.USER_PASSWORD_AUTH) // Fluxo de autenticação com usuário e senha
                    .clientId(clientId)
                    .authParameters(Map.of(
                            "USERNAME", username,
                            "PASSWORD", password))
                    .build();

            // Envia a solicitação de autenticação
            InitiateAuthResponse authResponse = cognitoClient.initiateAuth(authRequest);

            // Obtém e exibe os tokens
            String idToken = authResponse.authenticationResult().idToken();
            String accessToken = authResponse.authenticationResult().accessToken();
            String refreshToken = authResponse.authenticationResult().refreshToken();

            System.out.println("Autenticação bem-sucedida!");
            System.out.println("ID Token: " + idToken);
            System.out.println("Access Token: " + accessToken);
            System.out.println("Refresh Token: " + refreshToken);

        } catch (CognitoIdentityProviderException e) {
            System.err.println("Erro durante a autenticação: " + e.awsErrorDetails().errorMessage());
        }
    }
}
