@RegisterRestClient(configKey = "cognito-api")
public interface CognitoTokenClient {

    @POST
    @Consumes(MediaType.APPLICATION_FORM_URLENCODED)
    @javax.ws.rs.Path("/oauth2/token")
    Response getToken(
        @FormParam("grant_type") String grantType,
        @FormParam("client_id") String clientId,
        @FormParam("redirect_uri") String redirectUri,
        @FormParam("code") String code,
        @FormParam("scope") String scope
    );
}


@ApplicationScoped
public class CognitoAuthService {

    @Inject
    @RestClient
    CognitoTokenClient cognitoTokenClient;

    public String exchangeAuthorizationCodeForToken(String authorizationCode, String redirectUri) {
        String clientId = "seu-client-id";  // Substitua pelo seu Client ID
        String grantType = "authorization_code";
        String scope = "openid profile";  // Defina os escopos necessários

        // Fazer a chamada ao token endpoint com o authorization code
        Response response = cognitoTokenClient.getToken(grantType, clientId, redirectUri, authorizationCode, scope);

        if (response.getStatus() == 200) {
            String responseBody = response.readEntity(String.class);
            // Aqui você pode processar o JSON e extrair o token
            return responseBody;
        } else {
            throw new RuntimeException("Erro ao trocar código por token: " + response.getStatusInfo().getReasonPhrase());
        }
    }
}


import javax.ws.rs.GET;
import javax.ws.rs.Path;
import javax.ws.rs.QueryParam;
import javax.inject.Inject;

@Path("/callback")
public class AuthResource {

    @Inject
    CognitoAuthService authService;

    @GET
    public String handleAuthCallback(@QueryParam("code") String code, @QueryParam("state") String state) {
        String redirectUri = "http://localhost:8080/callback";  // O mesmo redirect_uri usado no authorize endpoint
        return authService.exchangeAuthorizationCodeForToken(code, redirectUri);
    }
}

https://<seu-pool-id>.auth.<regiao>.amazonaws.com/oauth2/authorize?response_type=code&client_id=seu-client-id&redirect_uri=http://localhost:8080/callback&scope=openid profile

