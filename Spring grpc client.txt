import software.amazon.awssdk.auth.credentials.EnvironmentVariableCredentialsProvider;
import software.amazon.awssdk.regions.Region;
import software.amazon.awssdk.services.cognitoidentityprovider.CognitoIdentityProviderClient;
import software.amazon.awssdk.services.cognitoidentityprovider.model.AuthFlowType;
import software.amazon.awssdk.services.cognitoidentityprovider.model.AdminInitiateAuthRequest;
import software.amazon.awssdk.services.cognitoidentityprovider.model.AdminInitiateAuthResponse;
import software.amazon.awssdk.services.cognitoidentityprovider.model.CognitoIdentityProviderException;

import java.util.HashMap;
import java.util.Map;

public class CognitoAuthExample {

    public static void main(String[] args) {

        String clientId = "SEU_CLIENT_ID";          // Substitua pelo seu Client ID
        String userPoolId = "SEU_USER_POOL_ID";     // Substitua pelo seu User Pool ID
        String username = "SEU_NOME_USUARIO";       // Nome de usuário do Cognito
        String password = "SUA_SENHA";              // Senha do usuário

        CognitoIdentityProviderClient cognitoClient = CognitoIdentityProviderClient.builder()
                .region(Region.US_EAST_1)  // Substitua pela região onde seu Cognito está configurado
                .credentialsProvider(EnvironmentVariableCredentialsProvider.create()) // Ou outra forma de fornecer credenciais
                .build();

        try {
            // Definir os parâmetros de autenticação
            Map<String, String> authParams = new HashMap<>();
            authParams.put("USERNAME", username);
            authParams.put("PASSWORD", password);

            // Criar a requisição de autenticação
            AdminInitiateAuthRequest authRequest = AdminInitiateAuthRequest.builder()
                    .userPoolId(userPoolId)
                    .clientId(clientId)
                    .authFlow(AuthFlowType.ADMIN_NO_SRP_AUTH)
                    .authParameters(authParams)
                    .build();

            // Executar a autenticação
            AdminInitiateAuthResponse authResponse = cognitoClient.adminInitiateAuth(authRequest);

            // Obter o token (JWT) de ID ou Access Token da resposta
            String idToken = authResponse.authenticationResult().idToken();
            String accessToken = authResponse.authenticationResult().accessToken();

            System.out.println("ID Token: " + idToken);
            System.out.println("Access Token: " + accessToken);

        } catch (CognitoIdentityProviderException e) {
            System.err.println(e.awsErrorDetails().errorMessage());
        } finally {
            cognitoClient.close();
        }
    }
}
